services:
  # OpenAlgo Main Service - FREE TIER OPTIMIZED
  - type: web
    name: hk-openalgo
    env: python
    repo: https://github.com/your-username/Hk_openalgo.git
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn --bind 0.0.0.0:$PORT --workers 1 --threads 2 --timeout 120 app:app & python keep_alive.py
    plan: free
    
    envVars:
      # Flask Configuration
      - key: FLASK_ENV
        value: production
      
      - key: SECRET_KEY
        generateValue: true
      
      # Database URL (uses Render's free PostgreSQL)
      - key: DATABASE_URL
        fromDatabase:
          name: hk-openalgo-db
          property: connectionString
      
      # Fyers API Configuration (YOU WILL ADD THESE)
      - key: BROKER
        value: fyers
      
      - key: FYERS_APP_ID
        sync: false
      
      - key: FYERS_SECRET_KEY
        sync: false
      
      - key: FYERS_REDIRECT_URI
        value: https://trade.fyers.in/api-login/redirect-uri/index.html
      
      # Keep Alive Configuration
      - key: RENDER_EXTERNAL_URL
        value: https://hk-openalgo.onrender.com
      
      - key: SELF_PING_INTERVAL
        value: 600
      
      # Performance Optimization for Free Tier
      - key: WEB_CONCURRENCY
        value: 1
      
      - key: WORKERS
        value: 1
      
      - key: THREADS
        value: 2
      
      # Timezone
      - key: TZ
        value: Asia/Kolkata

databases:
  # Free PostgreSQL Database
  - name: hk-openalgo-db
    databaseName: hk_openalgo
    user: hk_openalgo_user
    plan: free
    ipAllowList: []
